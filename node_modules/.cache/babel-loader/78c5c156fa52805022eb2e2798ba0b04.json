{"ast":null,"code":"import _classCallCheck from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _defineProperty from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";//https://www.npmjs.com/package/cordova-plugin-bluetoothle\n//startScan => connect => ...\n//                        disconnect => close\n//                        connect => disconnect => close => connect\n//::updating icons::\n//bond/unbond\n//discover\nimport React,{createRef}from'react';import{BluetoothLE as ble}from'@ionic-native/bluetooth-le/';import{OpenNativeSettings}from'@ionic-native/open-native-settings';import isEqual from'lodash.isequal';import BluetoothDeviceItem from'./BluetoothDeviceItem';var _Bluetooth=function _Bluetooth(){var states={};var deviceRefs={};var deviceItems=[];var serviceUuids=[];var ble=new Bluetooth();var bluetoothInitialize=function bluetoothInitialize(){ble.initialize();};var scan=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(t){var d;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return ble.scan(t);case 2:d=_context.sent;d.forEach(function(e){if(!checkAlreadyExists(e)){createDeviceItem(e,true);}});case 4:case\"end\":return _context.stop();}}},_callee);}));return function scan(_x){return _ref.apply(this,arguments);};}();var connect=function connect(id){updateDeviceItemState(id,'connecting');checkAlreadyConnecting(id);};var checkAlreadyExists=function checkAlreadyExists(d){var a=false;deviceItems.forEach(function(item){if(d.address===item.props.mac){a=true;}});return a;};var checkAlreadyConnecting=function checkAlreadyConnecting(id){deviceItems.forEach(function(item){//disconnecting any other currently connected devices and changing their respective states\nif((item.props.state()==='connecting'||item.props.state()==='connected')&&item.props.mac!==id){updateDeviceItemState(item.props.mac,'not_connected');deviceRefs[item.props.mac].current.rerender();}});};var createDeviceItem=function createDeviceItem(data,isFromUnpaired){if(states[data.address]===\"\"){return;//device already added to list\n}if(isFromUnpaired){serviceUuids.push.apply(serviceUuids,_toConsumableArray(data.advertisement.serviceUuids));states=_objectSpread(_objectSpread({},states),{},_defineProperty({},data.address,data.advertisement.isConnectable?'not_connected':'connected'));}deviceRefs=_objectSpread(_objectSpread({},deviceRefs),{},_defineProperty({},data.address,createRef()));deviceItems.push(/*#__PURE__*/React.createElement(BluetoothDeviceItem,{key:data.address,ref:deviceRefs[data.address],mac:data.address,name:data.name,onClick:function onClick(id){return connect(id);},state:function state(){return states[data.address];}}));};var updateDeviceItemState=function updateDeviceItemState(id,connectingState){states[id]=connectingState;};return{deviceItems:deviceItems,bluetoothInitialize:bluetoothInitialize,scan:scan};};export default _Bluetooth;var Bluetooth=/*#__PURE__*/function(){function Bluetooth(){_classCallCheck(this,Bluetooth);this.isEnabled=void 0;this.devices=[];this.isEnabled=false;}_createClass(Bluetooth,[{key:\"initialize\",value:function initialize(){var _this=this;ble.initialize({\"request\":true,\"statusReceiver\":true,\"restoreKey\":\"magic-light-ble\"}).subscribe(function(result){if(result.status==\"disabled\"){_this.isEnabled=false;console.log(\"1\");document.addEventListener(\"resume\",_this.onResume,true);_this.alert(\"Error\",\"\",\"Bluetooth is not enabled. Please enable Bluetooth and try again.\",[{text:'Settings',handler:function handler(){OpenNativeSettings.open(\"bluetooth\");}},{text:'Okay',handler:function handler(){_this.onResume();}}]);}else{_this.isEnabled=true;}});ble.stopScan();}},{key:\"scan\",value:function(){var _scan=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(scantime){var _this2=this;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!this.isEnabled){_context2.next=5;break;}ble.startScan({\"allowDuplicates\":false}).subscribe(function(result){if(result.status===\"scanResult\"){_this2.pushIfNotExists(result);}});_context2.next=4;return this.timeout(scantime);case 4:ble.stopScan().then(function(result){if(result.status!==\"scanStopped\"){//warn user?\n}});case 5:return _context2.abrupt(\"return\",this.devices);case 6:case\"end\":return _context2.stop();}}},_callee2,this);}));function scan(_x2){return _scan.apply(this,arguments);}return scan;}()},{key:\"pushIfNotExists\",value:function pushIfNotExists(d){var count=0;if(this.devices.length>0){this.devices.forEach(function(e){if(!isEqual(d,e)){count++;}});if(count>=this.devices.length){this.devices.push(d);}}else{this.devices.push(d);}}},{key:\"alert\",value:function alert(header,sub,message,buttons){var alert=document.createElement('ion-alert');alert.header=header;alert.subHeader=sub;alert.message=message;alert.buttons=buttons;document.body.appendChild(alert);return alert.present();}},{key:\"timeout\",value:function timeout(s){return new Promise(function(resolve){return setTimeout(resolve,s*1000);});}},{key:\"onResume\",value:function onResume(){var _this3=this;console.log(\"here1\");ble.isEnabled().then(function(result){console.log(\"here2\");if(result.isEnabled){console.log(\"here3\");_this3.isEnabled=true;document.removeEventListener(\"resume\",_this3.onResume);console.log(\"here4\");}});}}]);return Bluetooth;}();{/* \n\t\t\t\t<IonAlert\n\t\t\t\t\tisOpen={this.state.isBluetoothNotEnabled}\n\t\t\t\t\theader={'Error'}\n\t\t\t\t\tmessage={'Bluetooth is not enabled. Please enable Bluetooth and try again.'}\n\t\t\t\t\tbuttons={[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Settings',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tconsole.log('opening settings');\n\t\t\t\t\t\t\t\tOpenNativeSettings.open(\"bluetooth\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Okay',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tthis.bluetooth.bluetoothInitialize();\n\t\t\t\t\t\t\t\tthis.bluetooth.scan(10);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t\t/>\n\t\t\t\t<IonAlert\n\t\t\t\t\tisOpen={this.state.isErrorConnecting}\n\t\t\t\t\theader={'Error'}\n\t\t\t\t\tmessage={'There was an error connecting to the Bluetooth device. Make sure the device is turned on and try again.'}\n\t\t\t\t\tbuttons={['OK']}\n\t\t\t\t/>\n */}","map":{"version":3,"sources":["/Users/everyone/Desktop/iPhone app/magic-light/src/components/bluetooth/Bluetooth.tsx"],"names":["React","createRef","BluetoothLE","ble","OpenNativeSettings","isEqual","BluetoothDeviceItem","_Bluetooth","states","deviceRefs","deviceItems","serviceUuids","Bluetooth","bluetoothInitialize","initialize","scan","t","d","forEach","e","checkAlreadyExists","createDeviceItem","connect","id","updateDeviceItemState","checkAlreadyConnecting","a","item","address","props","mac","state","current","rerender","data","isFromUnpaired","push","advertisement","isConnectable","name","connectingState","isEnabled","devices","subscribe","result","status","console","log","document","addEventListener","onResume","alert","text","handler","open","stopScan","scantime","startScan","pushIfNotExists","timeout","then","count","length","header","sub","message","buttons","createElement","subHeader","body","appendChild","present","s","Promise","resolve","setTimeout","removeEventListener"],"mappings":"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","sourcesContent":["//https://www.npmjs.com/package/cordova-plugin-bluetoothle\n\n//startScan => connect => ...\n//                        disconnect => close\n//                        connect => disconnect => close => connect\n//::updating icons::\n\n//bond/unbond\n//discover\n\nimport React, { createRef } from 'react';\n\nimport { BluetoothLE as ble } from '@ionic-native/bluetooth-le/';\nimport { OpenNativeSettings } from '@ionic-native/open-native-settings'\nimport isEqual from 'lodash.isequal';\n\nimport BluetoothDeviceItem from './BluetoothDeviceItem';\n\nconst _Bluetooth = () => {\n\n\tlet states: {} = {};\n\tlet deviceRefs: {} = {};\n\tlet deviceItems: any[] = [];\n\n\tconst serviceUuids: string[] = [];\n\n\tconst ble = new Bluetooth();\n\n\tconst bluetoothInitialize = () => {\n\t\tble.initialize();\n\t}\n\n\tconst scan = async (t) => {\n\t\tlet d = await ble.scan(t);\n\t\td.forEach(e => {\n\t\t\tif(!checkAlreadyExists(e)) {\n\t\t\t\tcreateDeviceItem(e, true);\n\t\t\t}\n\t\t})\n\t}\n\n\tconst connect = (id) => {\n\t\tupdateDeviceItemState(id, 'connecting');\n\t\tcheckAlreadyConnecting(id);\n\t}\n\n\tconst checkAlreadyExists = (d) => {\n\t\tlet a = false;\n\t\tdeviceItems.forEach(item => { \n\t\t\tif(d.address === item.props.mac) {\n\t\t\t\ta = true;\n\t\t\t}\n\t\t});\n\t\treturn a;\n\t}\n\n\tconst checkAlreadyConnecting = (id) => {\n\t\tdeviceItems.forEach(item => { //disconnecting any other currently connected devices and changing their respective states\n\t\t\tif ((item.props.state() === 'connecting' || item.props.state() === 'connected') && item.props.mac !== id) {\n\t\t\t\tupdateDeviceItemState(item.props.mac, 'not_connected');\n\t\t\t\tdeviceRefs[item.props.mac].current.rerender();\n\t\t\t}\n\t\t});\n\t}\n\n\tconst createDeviceItem = (data, isFromUnpaired) => {\n\t\tif(states[data.address] === \"\"){\n\t\t\treturn; //device already added to list\n\t\t}\n\t\tif(isFromUnpaired) {\n\t\t\tserviceUuids.push(...data.advertisement.serviceUuids);\n\t\t\tstates = {...states, [data.address]: data.advertisement.isConnectable ? 'not_connected' : 'connected'};\n\t\t}\n\n\t\tdeviceRefs = {...deviceRefs, [data.address]: createRef<BluetoothDeviceItem>()};\n\t\tdeviceItems.push(<BluetoothDeviceItem key={data.address} ref={deviceRefs[data.address]} mac={data.address} name={data.name} onClick={(id) => connect(id)} state={() => {return states[data.address]}}></BluetoothDeviceItem>);\n\t}\n\n\tconst updateDeviceItemState = (id, connectingState) => {\n\t\tstates[id] = connectingState;\n\t}\n\n\treturn (\n\t\t{deviceItems, bluetoothInitialize, scan}\n\t);\n}\nexport default _Bluetooth; \n\n\nclass Bluetooth {\n\tisEnabled: boolean;\n\tdevices: any[] = [];\n\n\tconstructor() {\n\t\tthis.isEnabled = false;\n\t}\n\n\tinitialize(): void {\t\n\t\tble.initialize({\n\t\t\t\"request\": true,\n\t\t\t\"statusReceiver\": true,\n\t\t\t\"restoreKey\": \"magic-light-ble\"\n\t\t}).subscribe((result) => {\n\t\t\tif (result.status == \"disabled\") {\n\t\t\t\tthis.isEnabled = false;\n\t\t\t\tconsole.log(\"1\");\n\t\t\t\tdocument.addEventListener(\"resume\", this.onResume, true);\n\t\t\t\tthis.alert(\n\t\t\t\t\t\"Error\",\n\t\t\t\t\t\"\",\n\t\t\t\t\t\"Bluetooth is not enabled. Please enable Bluetooth and try again.\",\n\t\t\t\t\t[{\n\t\t\t\t\t\t\ttext: 'Settings',\n\t\t\t\t\t\t\thandler: () => { OpenNativeSettings.open(\"bluetooth\");}\n\t\t\t\t\t\t},{\n\t\t\t\t\t\t\ttext: 'Okay',\n\t\t\t\t\t\t\thandler: () => { this.onResume(); }\n\t\t\t\t\t}]\n\t\t\t\t);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.isEnabled = true;\n\t\t\t}\n\t\t});\n\n\t\tble.stopScan();\n\t}\n\n\tasync scan(scantime): Promise<any[]> {\n\t\tif(this.isEnabled) {\n\t\t\tble.startScan({\n\t\t\t\t\"allowDuplicates\": false,\n\t\t\t}).subscribe((result) => {\n\t\t\t\tif(result.status === \"scanResult\") {\n\t\t\t\t\tthis.pushIfNotExists(result);\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tawait this.timeout(scantime);\n\n\t\t\tble.stopScan().then((result) => {\n\t\t\t\tif(result.status !== \"scanStopped\") {\n\t\t\t\t\t//warn user?\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn this.devices;\n\t}\n\n\tpushIfNotExists(d): void {\n\t\tlet count = 0;\n\t\tif(this.devices.length > 0) {\n\t\t\tthis.devices.forEach(e => {\n\t\t\t\tif(!isEqual(d, e)) {\n\t\t\t\t\tcount++;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif(count >= this.devices.length) {\n\t\t\t\tthis.devices.push(d);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.devices.push(d);\n\t\t}\n\t}\n\n\talert(header, sub, message, buttons): Promise<void> {\n\t\tconst alert = document.createElement('ion-alert');\n\t\talert.header = header;\n\t\talert.subHeader = sub;\n\t\talert.message = message;\n\t\talert.buttons = buttons;\n\n\t\tdocument.body.appendChild(alert);\n\t\treturn alert.present();\n\t}\n\n\ttimeout(s): Promise<object> {\n\t\treturn new Promise(resolve => setTimeout(resolve, s * 1000));\n\t}\n \n\tonResume(): void {\n\t\tconsole.log(\"here1\")\n\t\tble.isEnabled().then((result) => {\n\t\t\tconsole.log(\"here2\")\n\t\t\tif(result.isEnabled){\n\t\t\t\tconsole.log(\"here3\")\n\t\t\t\tthis.isEnabled = true;\n\t\t\t\tdocument.removeEventListener(\"resume\", this.onResume);\n\t\t\t\tconsole.log(\"here4\")\n\t\t\t}\n\t\t});\n\t}\n}\n\n\n{/* \n\t\t\t\t<IonAlert\n\t\t\t\t\tisOpen={this.state.isBluetoothNotEnabled}\n\t\t\t\t\theader={'Error'}\n\t\t\t\t\tmessage={'Bluetooth is not enabled. Please enable Bluetooth and try again.'}\n\t\t\t\t\tbuttons={[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Settings',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tconsole.log('opening settings');\n\t\t\t\t\t\t\t\tOpenNativeSettings.open(\"bluetooth\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Okay',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tthis.bluetooth.bluetoothInitialize();\n\t\t\t\t\t\t\t\tthis.bluetooth.scan(10);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t\t/>\n\t\t\t\t<IonAlert\n\t\t\t\t\tisOpen={this.state.isErrorConnecting}\n\t\t\t\t\theader={'Error'}\n\t\t\t\t\tmessage={'There was an error connecting to the Bluetooth device. Make sure the device is turned on and try again.'}\n\t\t\t\t\tbuttons={['OK']}\n\t\t\t\t/>\n */}\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}