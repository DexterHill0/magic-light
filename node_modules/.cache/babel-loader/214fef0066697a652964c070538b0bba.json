{"ast":null,"code":"import _classCallCheck from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _defineProperty from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";//https://www.npmjs.com/package/cordova-plugin-bluetoothle\n//startScan => connect => ...\n//                        disconnect => close\n//                        connect => disconnect => close => connect\n//::updating icons::\n//bond/unbond\n//discover\nimport React,{createRef}from'react';import BluetoothDeviceItem from'./BluetoothDeviceItem';import{isPlatform}from'@ionic/react';var _Bluetooth=function _Bluetooth(){var states={};var deviceRefs={};var deviceItems=[];var serviceUuids=[];var bluetoothInitialize=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:case\"end\":return _context.stop();}}},_callee);}));return function bluetoothInitialize(){return _ref.apply(this,arguments);};}();var scan=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(t){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:case\"end\":return _context2.stop();}}},_callee2);}));return function scan(_x){return _ref2.apply(this,arguments);};}();var connect=function connect(id){updateDeviceItemState(id,'connecting');checkAlreadyConnecting(id);};var checkAlreadyConnecting=function checkAlreadyConnecting(id){deviceItems.forEach(function(item){//disconnecting any other currently connected devices and changing their respective states\nif((item.props.state()==='connecting'||item.props.state()==='connected')&&item.props.mac!==id){updateDeviceItemState(item.props.mac,'not_connected');deviceRefs[item.props.mac].current.rerender();}});};var createDeviceItem=function createDeviceItem(data,isFromUnpaired){if(states[data.address]===\"\"){return;//device already added to list\n}if(isPlatform(\"ios\")&&isFromUnpaired){serviceUuids.push.apply(serviceUuids,_toConsumableArray(data.advertisement.serviceUuids));states=_objectSpread(_objectSpread({},states),{},_defineProperty({},data.address,data.advertisement.isConnectable?'not_connected':'connected'));}else{states=_objectSpread(_objectSpread({},states),{},_defineProperty({},data.address,'not_connected'));}deviceRefs=_objectSpread(_objectSpread({},deviceRefs),{},_defineProperty({},data.address,createRef()));deviceItems.push(/*#__PURE__*/React.createElement(BluetoothDeviceItem,{ref:deviceRefs[data.address],mac:data.address,name:data.name,onClick:function onClick(id){return connect(id);},state:function state(){return states[data.address];}}));};var updateDeviceItemState=function updateDeviceItemState(id,connectingState){states[id]=connectingState;};var checkEnabled=function checkEnabled(){};var timeout=function timeout(s){return new Promise(function(resolve){return setTimeout(resolve,s*1000);});};return{deviceItems:deviceItems,bluetoothInitialize:bluetoothInitialize,scan:scan};};export default _Bluetooth;var BluetoothLE=/*#__PURE__*/function(){function BluetoothLE(){_classCallCheck(this,BluetoothLE);}_createClass(BluetoothLE,[{key:\"initialize\",value:function initialize(){return false;}}]);return BluetoothLE;}();{/* <IonAlert\n\t\t\t\t\tisOpen={this.state.isContinueNoDevice}\n\t\t\t\t\theader={'Continue?'}\n\t\t\t\t\tmessage={'Are you sure you want to continue without selecting a device?'}\n\t\t\t\t\tbuttons={[\n\t\t\t\t\t\t{ text: 'Cancel', },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Okay',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tconsole.log('continue ok'); //move to next screen\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]}\n\t\t\t\t/>\n\t\t\t\t<IonAlert\n\t\t\t\t\tisOpen={this.state.isBluetoothNotEnabled}\n\t\t\t\t\theader={'Error'}\n\t\t\t\t\tmessage={'Bluetooth is not enabled. Please enable Bluetooth and try again.'}\n\t\t\t\t\tbuttons={[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Settings',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tdocument.addEventListener(\"resume\", () => {\n\t\t\t\t\t\t\t\t\tthis.bluetooth.bluetoothInitialize();\n\t\t\t\t\t\t\t\t\tthis.bluetooth.scan(10);\n\t\t\t\t\t\t\t\t}, false);\n\t\t\t\t\t\t\t\tconsole.log('opening settings');\n\t\t\t\t\t\t\t\tOpenNativeSettings.open(\"bluetooth\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Okay',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tthis.bluetooth.bluetoothInitialize();\n\t\t\t\t\t\t\t\tthis.bluetooth.scan(10);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t\t/>\n\t\t\t\t<IonAlert\n\t\t\t\t\tisOpen={this.state.isErrorConnecting}\n\t\t\t\t\theader={'Error'}\n\t\t\t\t\tmessage={'There was an error connecting to the Bluetooth device. Make sure the device is turned on and try again.'}\n\t\t\t\t\tbuttons={['OK']}\n\t\t\t\t/>\n */}","map":{"version":3,"sources":["/Users/everyone/Desktop/iPhone app/magic-light/src/components/bluetooth/Bluetooth.tsx"],"names":["React","createRef","BluetoothDeviceItem","isPlatform","_Bluetooth","states","deviceRefs","deviceItems","serviceUuids","bluetoothInitialize","scan","t","connect","id","updateDeviceItemState","checkAlreadyConnecting","forEach","item","props","state","mac","current","rerender","createDeviceItem","data","isFromUnpaired","address","push","advertisement","isConnectable","name","connectingState","checkEnabled","timeout","s","Promise","resolve","setTimeout","BluetoothLE"],"mappings":"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","sourcesContent":["//https://www.npmjs.com/package/cordova-plugin-bluetoothle\n\n//startScan => connect => ...\n//                        disconnect => close\n//                        connect => disconnect => close => connect\n//::updating icons::\n\n//bond/unbond\n//discover\n\n\n\nimport React, { createRef } from 'react';\n\nimport { bluetoothSerial as bls } from 'cordova-plugin-bluetooth-serial/www/bluetoothSerial';\nimport { BLE as ble } from '@ionic-native/ble';\n\nimport BluetoothDeviceItem from './BluetoothDeviceItem';\nimport { isPlatform } from '@ionic/react';\n\nconst _Bluetooth = () => {\n\n\tlet states: {} = {};\n\tlet deviceRefs: {} = {};\n\tconst deviceItems: any[] = [];\n\n\tconst serviceUuids: string[] = [];\n\n\tconst bluetoothInitialize = async () => {\n\t}\n\n\tconst scan = async (t) => {\n\t}\n\tconst connect = (id) => {\n\t\tupdateDeviceItemState(id, 'connecting');\n\t\tcheckAlreadyConnecting(id);\n\t}\n\n\tconst checkAlreadyConnecting = (id) => {\n\t\tdeviceItems.forEach(item => { //disconnecting any other currently connected devices and changing their respective states\n\t\t\tif ((item.props.state() === 'connecting' || item.props.state() === 'connected') && item.props.mac !== id) {\n\t\t\t\tupdateDeviceItemState(item.props.mac, 'not_connected');\n\t\t\t\tdeviceRefs[item.props.mac].current.rerender();\n\t\t\t}\n\t\t});\n\t}\n\n\tconst createDeviceItem = (data, isFromUnpaired) => {\n\t\tif(states[data.address] === \"\"){\n\t\t\treturn; //device already added to list\n\t\t}\n\t\tif(isPlatform(\"ios\") && isFromUnpaired) {\n\t\t\tserviceUuids.push(...data.advertisement.serviceUuids);\n\t\t\tstates = {...states, [data.address]: data.advertisement.isConnectable ? 'not_connected' : 'connected'};\n\t\t}\n\t\telse {\n\t\t\tstates = {...states, [data.address]: 'not_connected'};\n\t\t}\n\n\t\tdeviceRefs = {...deviceRefs, [data.address]: createRef<BluetoothDeviceItem>()};\n\t\tdeviceItems.push(<BluetoothDeviceItem ref={deviceRefs[data.address]} mac={data.address} name={data.name} onClick={(id) => connect(id)} state={() => {return states[data.address]}}></BluetoothDeviceItem>);\n\t}\n\n\tconst updateDeviceItemState = (id, connectingState) => {\n\t\tstates[id] = connectingState;\n\t}\n\tconst checkEnabled = () => {\n\t}\n\tconst timeout = (s) => {\n\t\treturn new Promise(resolve => setTimeout(resolve, s * 1000));\n\t}\n\n\treturn (\n\t\t{deviceItems, bluetoothInitialize, scan}\n\t);\n}\nexport default _Bluetooth; \n\n\nclass BluetoothLE {\n\n\tinitialize(): boolean {\n\t\t\n\t\treturn false;\n\t}\n}\n\n\n{/* <IonAlert\n\t\t\t\t\tisOpen={this.state.isContinueNoDevice}\n\t\t\t\t\theader={'Continue?'}\n\t\t\t\t\tmessage={'Are you sure you want to continue without selecting a device?'}\n\t\t\t\t\tbuttons={[\n\t\t\t\t\t\t{ text: 'Cancel', },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Okay',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tconsole.log('continue ok'); //move to next screen\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]}\n\t\t\t\t/>\n\t\t\t\t<IonAlert\n\t\t\t\t\tisOpen={this.state.isBluetoothNotEnabled}\n\t\t\t\t\theader={'Error'}\n\t\t\t\t\tmessage={'Bluetooth is not enabled. Please enable Bluetooth and try again.'}\n\t\t\t\t\tbuttons={[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Settings',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tdocument.addEventListener(\"resume\", () => {\n\t\t\t\t\t\t\t\t\tthis.bluetooth.bluetoothInitialize();\n\t\t\t\t\t\t\t\t\tthis.bluetooth.scan(10);\n\t\t\t\t\t\t\t\t}, false);\n\t\t\t\t\t\t\t\tconsole.log('opening settings');\n\t\t\t\t\t\t\t\tOpenNativeSettings.open(\"bluetooth\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Okay',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tthis.bluetooth.bluetoothInitialize();\n\t\t\t\t\t\t\t\tthis.bluetooth.scan(10);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t\t/>\n\t\t\t\t<IonAlert\n\t\t\t\t\tisOpen={this.state.isErrorConnecting}\n\t\t\t\t\theader={'Error'}\n\t\t\t\t\tmessage={'There was an error connecting to the Bluetooth device. Make sure the device is turned on and try again.'}\n\t\t\t\t\tbuttons={['OK']}\n\t\t\t\t/>\n */}\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}