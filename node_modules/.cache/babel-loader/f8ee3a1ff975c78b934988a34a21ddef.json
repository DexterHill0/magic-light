{"ast":null,"code":"import _classCallCheck from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _defineProperty from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";//https://www.npmjs.com/package/cordova-plugin-bluetoothle\n//startScan => connect => ...\n//                        disconnect => close\n//                        connect => disconnect => close => connect\n//::updating icons::\n//bond/unbond\n//discover\nimport React,{createRef}from'react';import{BluetoothLE as ble}from'@ionic-native/bluetooth-le/';import BluetoothDeviceItem from'./BluetoothDeviceItem';import{isPlatform}from'@ionic/react';var _Bluetooth=function _Bluetooth(){var states={};var deviceRefs={};var deviceItems=[];var serviceUuids=[];var ble=new Bluetooth();var bluetoothInitialize=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:ble.initialize();case 1:case\"end\":return _context.stop();}}},_callee);}));return function bluetoothInitialize(){return _ref.apply(this,arguments);};}();var scan=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(t){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:ble.scan();case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function scan(_x){return _ref2.apply(this,arguments);};}();var connect=function connect(id){updateDeviceItemState(id,'connecting');checkAlreadyConnecting(id);};var checkAlreadyConnecting=function checkAlreadyConnecting(id){deviceItems.forEach(function(item){//disconnecting any other currently connected devices and changing their respective states\nif((item.props.state()==='connecting'||item.props.state()==='connected')&&item.props.mac!==id){updateDeviceItemState(item.props.mac,'not_connected');deviceRefs[item.props.mac].current.rerender();}});};var createDeviceItem=function createDeviceItem(data,isFromUnpaired){if(states[data.address]===\"\"){return;//device already added to list\n}if(isPlatform(\"ios\")&&isFromUnpaired){serviceUuids.push.apply(serviceUuids,_toConsumableArray(data.advertisement.serviceUuids));states=_objectSpread(_objectSpread({},states),{},_defineProperty({},data.address,data.advertisement.isConnectable?'not_connected':'connected'));}else{states=_objectSpread(_objectSpread({},states),{},_defineProperty({},data.address,'not_connected'));}deviceRefs=_objectSpread(_objectSpread({},deviceRefs),{},_defineProperty({},data.address,createRef()));deviceItems.push(/*#__PURE__*/React.createElement(BluetoothDeviceItem,{ref:deviceRefs[data.address],mac:data.address,name:data.name,onClick:function onClick(id){return connect(id);},state:function state(){return states[data.address];}}));};var updateDeviceItemState=function updateDeviceItemState(id,connectingState){states[id]=connectingState;};return{deviceItems:deviceItems,bluetoothInitialize:bluetoothInitialize,scan:scan};};export default _Bluetooth;var Bluetooth=/*#__PURE__*/function(){function Bluetooth(){_classCallCheck(this,Bluetooth);}_createClass(Bluetooth,[{key:\"initialize\",value:function initialize(){ble.initialize({\"request\":true,\"statusReceiver\":true,\"restoreKey\":\"magic-light-ble\"}).subscribe(function(result){console.log(result);});return false;}},{key:\"scan\",value:function(){var _scan=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",[]);case 1:case\"end\":return _context3.stop();}}},_callee3);}));function scan(){return _scan.apply(this,arguments);}return scan;}()},{key:\"timeouts\",value:function timeouts(s){return new Promise(function(resolve){return setTimeout(resolve,s*1000);});}},{key:\"onResume\",value:function onResume(){console.log(\"resumed!\");return this.initialize();}}]);return Bluetooth;}();//\n{/* <IonAlert\n\t\t\t\t\tisOpen={this.state.isContinueNoDevice}\n\t\t\t\t\theader={'Continue?'}\n\t\t\t\t\tmessage={'Are you sure you want to continue without selecting a device?'}\n\t\t\t\t\tbuttons={[\n\t\t\t\t\t\t{ text: 'Cancel', },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Okay',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tconsole.log('continue ok'); //move to next screen\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]}\n\t\t\t\t/>\n\t\t\t\t<IonAlert\n\t\t\t\t\tisOpen={this.state.isBluetoothNotEnabled}\n\t\t\t\t\theader={'Error'}\n\t\t\t\t\tmessage={'Bluetooth is not enabled. Please enable Bluetooth and try again.'}\n\t\t\t\t\tbuttons={[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Settings',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tconsole.log('opening settings');\n\t\t\t\t\t\t\t\tOpenNativeSettings.open(\"bluetooth\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Okay',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tthis.bluetooth.bluetoothInitialize();\n\t\t\t\t\t\t\t\tthis.bluetooth.scan(10);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t\t/>\n\t\t\t\t<IonAlert\n\t\t\t\t\tisOpen={this.state.isErrorConnecting}\n\t\t\t\t\theader={'Error'}\n\t\t\t\t\tmessage={'There was an error connecting to the Bluetooth device. Make sure the device is turned on and try again.'}\n\t\t\t\t\tbuttons={['OK']}\n\t\t\t\t/>\n */}","map":{"version":3,"sources":["/Users/everyone/Desktop/iPhone app/magic-light/src/components/bluetooth/Bluetooth.tsx"],"names":["React","createRef","BluetoothLE","ble","BluetoothDeviceItem","isPlatform","_Bluetooth","states","deviceRefs","deviceItems","serviceUuids","Bluetooth","bluetoothInitialize","initialize","scan","t","connect","id","updateDeviceItemState","checkAlreadyConnecting","forEach","item","props","state","mac","current","rerender","createDeviceItem","data","isFromUnpaired","address","push","advertisement","isConnectable","name","connectingState","subscribe","result","console","log","s","Promise","resolve","setTimeout"],"mappings":"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","sourcesContent":["//https://www.npmjs.com/package/cordova-plugin-bluetoothle\n\n//startScan => connect => ...\n//                        disconnect => close\n//                        connect => disconnect => close => connect\n//::updating icons::\n\n//bond/unbond\n//discover\n\n\n\nimport React, { createRef } from 'react';\n\nimport { BluetoothLE as ble } from '@ionic-native/bluetooth-le/';\n\nimport BluetoothDeviceItem from './BluetoothDeviceItem';\nimport { isPlatform } from '@ionic/react';\n\nconst _Bluetooth = () => {\n\n\tlet states: {} = {};\n\tlet deviceRefs: {} = {};\n\tconst deviceItems: any[] = [];\n\n\tconst serviceUuids: string[] = [];\n\n\tconst ble = new Bluetooth();\n\n\tconst bluetoothInitialize = async () => {\n\t\tble.initialize();\n\t}\n\n\tconst scan = async (t) => {\n\t\tble.scan();\n\t}\n\n\tconst connect = (id) => {\n\t\tupdateDeviceItemState(id, 'connecting');\n\t\tcheckAlreadyConnecting(id);\n\t}\n\n\tconst checkAlreadyConnecting = (id) => {\n\t\tdeviceItems.forEach(item => { //disconnecting any other currently connected devices and changing their respective states\n\t\t\tif ((item.props.state() === 'connecting' || item.props.state() === 'connected') && item.props.mac !== id) {\n\t\t\t\tupdateDeviceItemState(item.props.mac, 'not_connected');\n\t\t\t\tdeviceRefs[item.props.mac].current.rerender();\n\t\t\t}\n\t\t});\n\t}\n\n\tconst createDeviceItem = (data, isFromUnpaired) => {\n\t\tif(states[data.address] === \"\"){\n\t\t\treturn; //device already added to list\n\t\t}\n\t\tif(isPlatform(\"ios\") && isFromUnpaired) {\n\t\t\tserviceUuids.push(...data.advertisement.serviceUuids);\n\t\t\tstates = {...states, [data.address]: data.advertisement.isConnectable ? 'not_connected' : 'connected'};\n\t\t}\n\t\telse {\n\t\t\tstates = {...states, [data.address]: 'not_connected'};\n\t\t}\n\n\t\tdeviceRefs = {...deviceRefs, [data.address]: createRef<BluetoothDeviceItem>()};\n\t\tdeviceItems.push(<BluetoothDeviceItem ref={deviceRefs[data.address]} mac={data.address} name={data.name} onClick={(id) => connect(id)} state={() => {return states[data.address]}}></BluetoothDeviceItem>);\n\t}\n\n\tconst updateDeviceItemState = (id, connectingState) => {\n\t\tstates[id] = connectingState;\n\t}\n\n\treturn (\n\t\t{deviceItems, bluetoothInitialize, scan}\n\t);\n}\nexport default _Bluetooth; \n\n\nclass Bluetooth {\n\n\tinitialize(): boolean {\n\t\tble.initialize({\n\t\t\t\"request\": true,\n\t\t\t\"statusReceiver\": true,\n\t\t\t\"restoreKey\" : \"magic-light-ble\"\n\t\t  }).subscribe((result) => {\n\t\t\tconsole.log(result);\n\t\t  });\n\t\treturn false;\n\t}\n\n\tasync scan(): Promise<any[]> {\n\t\treturn [];\n\t}\n\n\ttimeouts(s): Promise<object> {\n\t\treturn new Promise(resolve => setTimeout(resolve, s * 1000));\n\t}\n \n\tonResume(): boolean {\n\t\tconsole.log(\"resumed!\");\n\t\treturn this.initialize()\n\t}\n}\n\n//\n\n\n{/* <IonAlert\n\t\t\t\t\tisOpen={this.state.isContinueNoDevice}\n\t\t\t\t\theader={'Continue?'}\n\t\t\t\t\tmessage={'Are you sure you want to continue without selecting a device?'}\n\t\t\t\t\tbuttons={[\n\t\t\t\t\t\t{ text: 'Cancel', },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Okay',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tconsole.log('continue ok'); //move to next screen\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]}\n\t\t\t\t/>\n\t\t\t\t<IonAlert\n\t\t\t\t\tisOpen={this.state.isBluetoothNotEnabled}\n\t\t\t\t\theader={'Error'}\n\t\t\t\t\tmessage={'Bluetooth is not enabled. Please enable Bluetooth and try again.'}\n\t\t\t\t\tbuttons={[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Settings',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tconsole.log('opening settings');\n\t\t\t\t\t\t\t\tOpenNativeSettings.open(\"bluetooth\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Okay',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tthis.bluetooth.bluetoothInitialize();\n\t\t\t\t\t\t\t\tthis.bluetooth.scan(10);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t\t/>\n\t\t\t\t<IonAlert\n\t\t\t\t\tisOpen={this.state.isErrorConnecting}\n\t\t\t\t\theader={'Error'}\n\t\t\t\t\tmessage={'There was an error connecting to the Bluetooth device. Make sure the device is turned on and try again.'}\n\t\t\t\t\tbuttons={['OK']}\n\t\t\t\t/>\n */}\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}