{"ast":null,"code":"import _defineProperty from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/everyone/Desktop/iPhone app/magic-light/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";//https://www.npmjs.com/package/cordova-plugin-bluetoothle\n//startScan => connect => ...\n//                        disconnect => close\n//                        connect => disconnect => close => connect\n//::updating icons::\n//bond/unbond\n//discover\nimport React,{createRef}from'react';import BluetoothDeviceItem from'./BluetoothDeviceItem';var _Bluetooth=function _Bluetooth(){var states={};var deviceRefs={};var deviceItems=[];var bluetoothInitialize=function bluetoothInitialize(){for(var i=0;i<5;i++){var a={name:\"test_\"+i,mac:i.toString(),connected:false};createDeviceItem(a);}};var connect=function connect(id){deviceItems.forEach(function(item){//disconnecting any other currently connected devices and changing their respective states\nif(id===item.props.mac){updateDeviceItemState(item.props.mac,'connecting');}if((item.props.state()==='connecting'||item.props.state()==='connected')&&item.props.mac!==id){updateDeviceItemState(item.props.mac,'not_connected');deviceRefs[item.props.mac].current.rerender();}});};var createDeviceItem=function createDeviceItem(data){states=_objectSpread(_objectSpread({},states),{},_defineProperty({},data.mac,data.connected?'connected':'not_connected'));deviceRefs=_objectSpread(_objectSpread({},deviceRefs),{},_defineProperty({},data.mac,createRef()));deviceItems.push(/*#__PURE__*/React.createElement(BluetoothDeviceItem,{ref:deviceRefs[data.mac],key:data.mac,mac:data.mac,name:data.name,onClick:function onClick(id){return connect(id);},state:function state(){return states[data.mac];}}));};var updateDeviceItemState=function updateDeviceItemState(id,connectingState){states[id]=connectingState;};return{deviceItems:deviceItems,bluetoothInitialize:bluetoothInitialize};};export default _Bluetooth;{/* <IonAlert\n\t\t\t\t\tisOpen={this.state.isContinueNoDevice}\n\t\t\t\t\theader={'Continue?'}\n\t\t\t\t\tmessage={'Are you sure you want to continue without selecting a device?'}\n\t\t\t\t\tbuttons={[\n\t\t\t\t\t\t{ text: 'Cancel', },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Okay',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tconsole.log('continue ok'); //move to next screen\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]}\n\t\t\t\t/>\n\t\t\t\t<IonAlert\n\t\t\t\t\tisOpen={this.state.isBluetoothNotEnabled}\n\t\t\t\t\theader={'Error'}\n\t\t\t\t\tmessage={'Bluetooth is not enabled. Please enable Bluetooth and try again.'}\n\t\t\t\t\tbuttons={[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Settings',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tdocument.addEventListener(\"resume\", () => {\n\t\t\t\t\t\t\t\t\tthis.bluetooth.bluetoothInitialize();\n\t\t\t\t\t\t\t\t\tthis.bluetooth.scan(10);\n\t\t\t\t\t\t\t\t}, false);\n\t\t\t\t\t\t\t\tconsole.log('opening settings');\n\t\t\t\t\t\t\t\tOpenNativeSettings.open(\"bluetooth\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Okay',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tthis.bluetooth.bluetoothInitialize();\n\t\t\t\t\t\t\t\tthis.bluetooth.scan(10);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t\t/>\n\t\t\t\t<IonAlert\n\t\t\t\t\tisOpen={this.state.isErrorConnecting}\n\t\t\t\t\theader={'Error'}\n\t\t\t\t\tmessage={'There was an error connecting to the Bluetooth device. Make sure the device is turned on and try again.'}\n\t\t\t\t\tbuttons={['OK']}\n\t\t\t\t/>\n */}//this.checkEnabled();\n// await this.props.ble.initialize( {\"request\": true, \"statusReceiver\": false, \"restoreKey\": \"magic-light-ble\"} ).subscribe((result) => {\n//   if(result.status === \"disabled\") {\n//     this.checkEnabled();\n//   }\n// });\n// const scan = async (timeout) => {\n// \tif (!isCordova) {\n// \t\t//this.props.ble.stopScan(); //stop any current scans\n// \t\tconsole.log(\"scanning!\");\n// \t\t// this.props.ble.startScan( {\"allowDuplicates\": false, \"isConnectable\": true}  ).subscribe((result) => {\n// \t\t//   if(result.status === \"scanResult\") {\n// \t\t//     this.devices.push(result);\n// \t\t//   }\n// \t\t//   else if(result.status !== \"scanStarted\") {\n// \t\t//     this.checkEnabled();\n// \t\t//   }\n// \t\t// });\n// \t\tBluetoothProps.bls.discoverUnpaired().then(function (result) {\n// \t\t\tconsole.log(result);\n// \t\t});\n// \t\tawait timeout(timeout);\n// \t\t//this.props.ble.stopScan();\n// \t\tconsole.log(\"stopped scan!\");\n// \t}\n// }\n// const checkEnabled = () => {\n// \t//this.props.ble.isEnabled().then(isEnabled); //is bluetooth le enabled\n// \t//this.props.ble.isEnabled().then(resp => !resp.isEnabled ? this.setState({isBluetoothEnabled: false}) : this.setState({isBluetoothEnabled: true}) );\n// }\n// const timeout = (s) => {\n// \treturn new Promise(resolve => setTimeout(resolve, s * 1000));\n// }\n// if (!isPlatform('cordova')) {\n// \tconsole.log(\"platform not cordova, BLE will not work!\");\n// \t//set cordova variable\n// \treturn;\n// }","map":{"version":3,"sources":["/Users/everyone/Desktop/iPhone app/magic-light/src/components/bluetooth/Bluetooth.tsx"],"names":["React","createRef","BluetoothDeviceItem","_Bluetooth","states","deviceRefs","deviceItems","bluetoothInitialize","i","a","name","mac","toString","connected","createDeviceItem","connect","id","forEach","item","props","updateDeviceItemState","state","current","rerender","data","push","connectingState"],"mappings":"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","sourcesContent":["//https://www.npmjs.com/package/cordova-plugin-bluetoothle\n\n//startScan => connect => ...\n//                        disconnect => close\n//                        connect => disconnect => close => connect\n//::updating icons::\n\n//bond/unbond\n//discover\n\n\n\nimport React, { createRef, useRef } from 'react';\n\nimport BluetoothLE from '@ionic-native/bluetooth-le';\nimport BluetoothSerial from '@ionic-native/bluetooth-serial';\n\nimport BluetoothDeviceItem from './BluetoothDeviceItem';\n\nconst _Bluetooth = () => {\n\n\tlet states: {} = {};\n\tlet deviceRefs: {} = {};\n\tconst deviceItems: any[] = [];\n\n\tconst bluetoothInitialize = () => {\n\t\tfor (let i = 0; i < 5; i++) {\n\t\t\tlet a = {name: \"test_\"+i, mac: i.toString(), connected: false}\n\t\t\tcreateDeviceItem(a);\n\t\t}\n\t}\n\n\tconst connect = (id) => {\n\t\tdeviceItems.forEach(item => { //disconnecting any other currently connected devices and changing their respective states\n\t\t\tif(id === item.props.mac) {\n\t\t\t\tupdateDeviceItemState(item.props.mac, 'connecting');\n\t\t\t}\n\n\t\t\tif ((item.props.state() === 'connecting' || item.props.state() === 'connected') && item.props.mac !== id) {\n\t\t\t\tupdateDeviceItemState(item.props.mac, 'not_connected');\n\t\t\t\tdeviceRefs[item.props.mac].current.rerender();\n\t\t\t}\n\n\t\t});\n\t}\n\n\tconst createDeviceItem = (data) => {\n\t\tstates = {...states, [data.mac]: data.connected ? 'connected' : 'not_connected'}\n\t\tdeviceRefs = {...deviceRefs, [data.mac]: createRef<BluetoothDeviceItem>()};\n\t\tdeviceItems.push(<BluetoothDeviceItem ref={deviceRefs[data.mac]} key={data.mac} mac={data.mac} name={data.name} onClick={(id) => connect(id)} state={() => {return states[data.mac]}}></BluetoothDeviceItem>);\n\t}\n\tconst updateDeviceItemState = (id, connectingState) => {\n\t\tstates[id] = connectingState;\n\t}\n\n\treturn (\n\t\t{deviceItems, bluetoothInitialize}\n\t);\n}\nexport default _Bluetooth;\n\n\n\n{/* <IonAlert\n\t\t\t\t\tisOpen={this.state.isContinueNoDevice}\n\t\t\t\t\theader={'Continue?'}\n\t\t\t\t\tmessage={'Are you sure you want to continue without selecting a device?'}\n\t\t\t\t\tbuttons={[\n\t\t\t\t\t\t{ text: 'Cancel', },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Okay',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tconsole.log('continue ok'); //move to next screen\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]}\n\t\t\t\t/>\n\t\t\t\t<IonAlert\n\t\t\t\t\tisOpen={this.state.isBluetoothNotEnabled}\n\t\t\t\t\theader={'Error'}\n\t\t\t\t\tmessage={'Bluetooth is not enabled. Please enable Bluetooth and try again.'}\n\t\t\t\t\tbuttons={[\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Settings',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tdocument.addEventListener(\"resume\", () => {\n\t\t\t\t\t\t\t\t\tthis.bluetooth.bluetoothInitialize();\n\t\t\t\t\t\t\t\t\tthis.bluetooth.scan(10);\n\t\t\t\t\t\t\t\t}, false);\n\t\t\t\t\t\t\t\tconsole.log('opening settings');\n\t\t\t\t\t\t\t\tOpenNativeSettings.open(\"bluetooth\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: 'Okay',\n\t\t\t\t\t\t\thandler: () => {\n\t\t\t\t\t\t\t\tthis.bluetooth.bluetoothInitialize();\n\t\t\t\t\t\t\t\tthis.bluetooth.scan(10);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t\t/>\n\t\t\t\t<IonAlert\n\t\t\t\t\tisOpen={this.state.isErrorConnecting}\n\t\t\t\t\theader={'Error'}\n\t\t\t\t\tmessage={'There was an error connecting to the Bluetooth device. Make sure the device is turned on and try again.'}\n\t\t\t\t\tbuttons={['OK']}\n\t\t\t\t/>\n */}\n\n\n //this.checkEnabled();\n\n\t\t// await this.props.ble.initialize( {\"request\": true, \"statusReceiver\": false, \"restoreKey\": \"magic-light-ble\"} ).subscribe((result) => {\n\t\t//   if(result.status === \"disabled\") {\n\t\t//     this.checkEnabled();\n\t\t//   }\n\t\t// });\n\n\t\t// const scan = async (timeout) => {\n\t// \tif (!isCordova) {\n\t// \t\t//this.props.ble.stopScan(); //stop any current scans\n\n\t// \t\tconsole.log(\"scanning!\");\n\n\t// \t\t// this.props.ble.startScan( {\"allowDuplicates\": false, \"isConnectable\": true}  ).subscribe((result) => {\n\t// \t\t//   if(result.status === \"scanResult\") {\n\t// \t\t//     this.devices.push(result);\n\t// \t\t//   }\n\t// \t\t//   else if(result.status !== \"scanStarted\") {\n\t// \t\t//     this.checkEnabled();\n\t// \t\t//   }\n\t// \t\t// });\n\n\t// \t\tBluetoothProps.bls.discoverUnpaired().then(function (result) {\n\t// \t\t\tconsole.log(result);\n\t// \t\t});\n\n\t// \t\tawait timeout(timeout);\n\t// \t\t//this.props.ble.stopScan();\n\n\t// \t\tconsole.log(\"stopped scan!\");\n\t// \t}\n\t// }\n\n\t\t// const checkEnabled = () => {\n\n\t// \t//this.props.ble.isEnabled().then(isEnabled); //is bluetooth le enabled\n\t// \t//this.props.ble.isEnabled().then(resp => !resp.isEnabled ? this.setState({isBluetoothEnabled: false}) : this.setState({isBluetoothEnabled: true}) );\n\n\t// }\n\n\t// const timeout = (s) => {\n\t// \treturn new Promise(resolve => setTimeout(resolve, s * 1000));\n\t// }\n\n\n\n\t\t\t// if (!isPlatform('cordova')) {\n\t\t// \tconsole.log(\"platform not cordova, BLE will not work!\");\n\t\t// \t//set cordova variable\n\t\t// \treturn;\n\t\t// }\n\n\n"]},"metadata":{},"sourceType":"module"}